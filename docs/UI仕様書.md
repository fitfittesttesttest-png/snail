# CPシステムUI仕様書

## 1. システム概要

本システムは、工場内に設置された複数タンクの在庫量をリアルタイムで監視・記録・分析し、帳票出力およびアラート通知を行う在庫管理システムである。:contentReference[oaicite:0]{index=0}

### 1.1 ハードウェア構成図

- オンプレミスサーバ
  - DCSゲートウェイと接続
  - 工場内 LAN（Ethernet）に接続
- クライアントPC
  - 工場内 LAN（Ethernet）に接続
- DCS ゲートウェイ
  - オンプレサーバと TCP/IP で接続
- ネットワーク
  - Ethernet / LAN
  - 通信プロトコル：TCP/IP:contentReference[oaicite:1]{index=1}

※詳細な構成は別途ハードウェア構成図を参照。

### 1.2 ソフトウェア構成図

- サーバ側
  - OS：Linux（CentOS 8）
  - 業務アプリケーション：Java 8（64bit）
  - データベース：PostgreSQL 14
  - 通信：TCP/IP
- クライアント側
  - OS：Windows 11
  - 本仕様書で定義する各種画面を表示するクライアントアプリケーション:contentReference[oaicite:2]{index=2}

---

## 2. 画面仕様

### 2.1 メニュー画面

#### 2.1.1 画面イメージ

- メニュー画面上に以下のボタンを配置する。  
  - 「データ表示画面」ボタン（a）
  - 「操業計算画面」ボタン（b）
  - 「帳票出力画面」ボタン（c）
  - 「終了」ボタン（d）:contentReference[oaicite:3]{index=3}

#### 2.1.2 画面項目

| ID | 項目名                     | 種別   | 説明 |
|----|----------------------------|--------|------|
| a  | データ表示画面ボタン       | ボタン | 押下時、「データ表示画面」を表示し、本画面を閉じる。 |
| b  | 操業計算画面ボタン         | ボタン | 押下時、「操業計算画面」を表示し、本画面を閉じる。 |
| c  | 帳票出力画面ボタン         | ボタン | 押下時、「帳票出力画面」を表示し、本画面を閉じる。 |
| d  | 終了ボタン                 | ボタン | 押下時、本画面を閉じ、システムを終了する。 |:contentReference[oaicite:4]{index=4}

#### 2.1.3 画面動作

- 各ボタン押下時に対応する画面を1つだけ表示する（同時に複数画面は表示しない）。:contentReference[oaicite:5]{index=5}  

---

### 2.2 データ表示画面

#### 2.2.1 画面イメージ

- 入力項目
  - 項目No
  - 日時
- 表示領域
  - 項目名
  - 指定日時から過去 10 回分の時系列データ（例：1分毎）
  - グラフ表示
- ボタン
  - 「表示」ボタン（a）
  - 「終了」ボタン（b）
- メッセージ
  - 異常メッセージ表示欄:contentReference[oaicite:6]{index=6}

#### 2.2.2 画面項目

| ID | 項目名           | 種別     | 説明 |
|----|------------------|----------|------|
| -  | 項目No           | 入力欄   | 表示対象データの項目番号を入力する。 |
| -  | 日時             | 入力欄   | 表示基準となる日時を入力する。 |
| a  | 表示ボタン       | ボタン   | 入力された項目Noと日時を基に、データ名、基準日時から10回前までの時系列値、およびグラフを表示する。異常時はメッセージを表示。 |
| -  | データ名表示欄   | 表示欄   | 項目Noに対応するデータ名を表示する。 |
| -  | 数値一覧         | 表示欄   | 指定日時およびそこから 10 回前までの値を表示する。 |
| -  | グラフ表示       | グラフ   | 時系列データをグラフ表示する。 |
| -  | 異常メッセージ   | 表示欄   | 入力チェック結果などの異常メッセージを表示する。 |
| b  | 終了ボタン       | ボタン   | 本画面を閉じ、システムを終了する。 |:contentReference[oaicite:7]{index=7}

#### 2.2.3 画面動作

- 指定された日時のデータを数値およびグラフで表示する。
- 表示ボタン押下時に入力値チェックおよびデータ取得・表示を行う。:contentReference[oaicite:8]{index=8}

#### 2.2.4 異常処理

以下の入力チェックを行い、異常がある場合は異常メッセージ欄にメッセージを表示する。

- 日時が許容範囲外の場合  
  - メッセージ例：「現在時刻より前の日時を入力してください」
- 項目Noが未入力の場合  
  - メッセージ例：「項目Noを入力してください」
- 未定義の項目Noが入力された場合  
  - メッセージ例：「この項目Noは定義されていません」:contentReference[oaicite:9]{index=9}

#### 2.2.5 項目一覧（例）

| No | データ名           |
|----|--------------------|
| 1  | 貯水槽タンク量     |
| 2  | 電力量             |
| 3  | タンク内温度       |:contentReference[oaicite:10]{index=10}

---

### 2.3 操業計算画面

#### 2.3.1 画面イメージ

- 入力項目（計算係数、数量・温度・流量など）
  - AA温度
  - BB温度
  - CC流量
  - DD量
  - EE数
  - FF割合
  - GG数
  - HH目標
  - II値
  - JJ係数
  - KK係数
  - LL数
- 計算結果表示欄（a）
- ボタン
  - 計算ボタン（c）
  - 確定ボタン（d）
  - メニューボタン（e）
  - 終了ボタン（f）:contentReference[oaicite:11]{index=11}

#### 2.3.2 画面項目

| ID | 項目名                 | 種別   | 説明 |
|----|------------------------|--------|------|
| a  | 計算結果表示欄         | 表示欄 | 直近に実行した計算結果を表示する。 |
| b  | 計算係数値入力欄       | 入力欄 | 計算に使用する係数を入力する。0〜999.999 の範囲。数字以外は入力不可。 |
| c  | 計算ボタン             | ボタン | 格納済みデータと計算係数値入力欄（b）の値を用いて計算を実行する。結果が上下限を超える場合、結果表示を赤文字とする。 |
| d  | 確定ボタン             | ボタン | 計算結果表示欄（a）と計算係数（b）の値を保存する。 |
| e  | メニューボタン         | ボタン | メニュー画面を開き、本画面を閉じる。 |
| f  | 終了ボタン             | ボタン | 本画面を閉じ、システムを終了する。 |:contentReference[oaicite:12]{index=12}

#### 2.3.3 画面動作

- 計算係数の入力および計算処理の実行・結果表示・結果確定を行う。:contentReference[oaicite:13]{index=13}

---

### 2.4 帳票出力画面

#### 2.4.1 画面イメージ

- 入力項目
  - 日時
- ボタン
  - 日次データ出力ボタン（a）
  - 月次データ出力ボタン（b）
  - 年次データ出力ボタン（c）
  - 終了ボタン（d）
- メッセージ
  - 異常メッセージ表示欄:contentReference[oaicite:14]{index=14}

#### 2.4.2 画面項目

| ID | 項目名                 | 種別   | 説明 |
|----|------------------------|--------|------|
| -  | 日時                   | 入力欄 | 帳票出力対象となる日付（または年月）を入力する。 |
| a  | 日次データ出力ボタン   | ボタン | 入力された日時に応じた日次帳票を表示し、本画面を閉じる。 |
| b  | 月次データ出力ボタン   | ボタン | 入力された日時に応じた月次帳票を表示し、本画面を閉じる。 |
| c  | 年次データ出力ボタン   | ボタン | 入力された日時に応じた年次帳票を表示し、本画面を閉じる。 |
| d  | 終了ボタン             | ボタン | 本画面を閉じ、システムを終了する。 |:contentReference[oaicite:15]{index=15}

#### 2.4.3 画面動作

- 日次・月次・年次の帳票データを出力する。  
- 各ボタン押下時に対象期間の帳票を生成し表示する。:contentReference[oaicite:16]{index=16}

#### 2.4.4 異常処理

- 入力された日時が許容範囲外の場合、異常メッセージ欄に以下のようなメッセージを表示する。  
  - メッセージ例：「現在時刻より前の日時を入力してください」:contentReference[oaicite:17]{index=17}

---

### 2.5 画面遷移

- デスクトップからメニュー画面を起動する。
- メニュー画面からの遷移
  - 「データ表示画面」ボタン押下：データ表示画面を表示。
  - 「操業計算画面」ボタン押下：操業計算画面を表示。
  - 「帳票出力画面」ボタン押下：帳票出力画面を表示。
  - 「終了」ボタン押下：システム終了。:contentReference[oaicite:18]{index=18}

---

## 3. 帳票仕様（Excel）

### 3.1 目的・概要

- 収集・蓄積されている日次・月次・年次データを、Excel フォーマットの帳票として表示する機能。
- 帳票テンプレートは事前に利用者が手順に従って作成した Excel ファイルを使用する。:contentReference[oaicite:19]{index=19}

### 3.2 動作条件

- 帳票出力画面で対象帳票および日付を指定し、該当ボタンをクリックしたタイミングで Excel 帳票を表示する。:contentReference[oaicite:20]{index=20}

### 3.3 機能詳細

#### 3.3.1 表示方式

- 帳票メニューで指定された帳票種別（日次・月次・年次）に応じて、対応する Excel テンプレートファイルを選択し表示する。
- 表示は Excel の機能をそのまま利用する。:contentReference[oaicite:21]{index=21}

#### 3.3.2 初期表示

- 帳票は Excel で開き、対象テンプレートに定義されたレイアウトで表示する。:contentReference[oaicite:22]{index=22}

#### 3.3.3 画面構成

##### (1) 操作ボタン表示領域

- 帳票機能用のボタン（印刷、終了など）を表示する。
- ボタンはユーザ定義の VBA ボタンとして実装する。
- Excel 標準のリボン表示／非表示は、本仕様では制御しない（案件ごとに任意設定）。:contentReference[oaicite:23]{index=23}

##### (2) 帳票表示領域

- 対象帳票の Excel フォーマットを表示する。
- Excel 側で「ウィンドウ枠の固定」が定義されている場合、その設定に従う。
- 未定義の場合は、セル「A2」でウィンドウ枠を固定する。:contentReference[oaicite:24]{index=24}

##### (3) 帳票データ表示領域

- Excel 各セルに、指定日付の帳票データ項目を表示する。
- 表示データには、時系列情報・集計情報・ステータス情報が含まれる。
- 利用者による変更不可とすべきセル（データ設定不可セルや集計部）は、セルロックにより編集不可とする。
- ロックされたセルをダブルクリックなどで編集しようとした場合、Excel 標準ダイアログで編集不可であることを通知する。:contentReference[oaicite:25]{index=25}

---

### 3.4 データ表示仕様

#### 3.4.1 データ状態別の表示規則

- 有効データ  
  - 黒色の数値で表示する。
- 無効データ  
  - 黒色で「****」を表示する。
- 未収集データ  
  - 空白表示とする。
- 桁あふれ  
  - 「####」を表示する（Excel 標準の表示）。  
  - セル選択により実数値の確認は可能。:contentReference[oaicite:26]{index=26}

#### 3.4.2 時系列データの表示

- 日付表示
  - 日次：`yyyy年 mm月 dd日`
  - 月次：`yyyy年 mm月`
  - 年次：`yyyy年`
- 時系列データの単位
  - 日次：0時〜24時
  - 月次：1日〜31日
  - 年次：1月〜12月
- 集計値の表示
  - 平均値
  - 合計値
  - 最大値およびその時刻
  - 最小値およびその時刻
- 時刻の扱い
  - 最大・最小値を計上した時点（例：日次なら「時」、月次なら「日」、年次なら「月」）を表示する。:contentReference[oaicite:27]{index=27}

---

### 3.5 操作ボタンの動作

#### 3.5.1 「印刷」ボタン

- 表示中の帳票を、Excel の印刷機能を用いて直接印刷する。
- 印刷ダイアログは表示せず、PC のデフォルトプリンタに対して出力する。:contentReference[oaicite:28]{index=28}

#### 3.5.2 「終了」ボタン

- 表示中の帳票 Excel をクローズする。:contentReference[oaicite:29]{index=29}

---

## 4. テーブル一覧

※本仕様書の目次より。詳細な項目定義は別途テーブル定義書を参照する。

### 4.1 DCS 1分毎テーブル

- DCS から取得した 1分毎のデータを格納するテーブル。

### 4.2 DCS イベント毎テーブル

- DCS イベント発生時のデータを格納するテーブル。

### 4.3 計算結果テーブル

- 操業計算画面で確定した計算結果および係数を格納するテーブル。:contentReference[oaicite:30]{index=30}

---

## 5. 伝送

- DCS ゲートウェイとサーバ間、サーバとクライアントPC間の通信は TCP/IP を使用する。
- 通信路は工場内 LAN（Ethernet）を使用する。
